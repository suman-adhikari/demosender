@model VasupDemoServerModel.TeaserList
@{
    ViewBag.Title = "Teaser Demo Sender";
    ViewBag.header = "Teaser Demo Sender";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var baseurl = Request.Url.GetLeftPart(UriPartial.Authority) + Request.ApplicationPath;
}



<div class="col-md-7">
   
    <div class="UnifunBlock" style="margin-top: 50px;">
        <h2 class="UnifunHeading2">Teaser Sending</h2>

        <div class="clearfix"></div>
     
@using (Html.BeginForm("SaveuserForm", "UserManagement", FormMethod.Post, new {@class = "form-inline", @id = "DashboardSendDemoForm"}))
{

    <div class="clearfix"></div>
    <div class="form-group">
      
        @Html.LabelFor(x => x.TeaserName, new { @class = "control-label" })

        @*<select name="TeaserIDCodeDemo" id="TeaserIDDemo" class="form-control " style="width: 200px;">
            <option data-id="-1" value=""
                    style="display: none;">
                select teaser
            </option>
            <option value="1">one</option>
            <option value="2">two</option>
            <option value="3">three</option>

            <option data-id="<?php echo $teaser->ID; ?>"
                    value="<?php echo $teaser->TeaserIdCode; ?>"></option>
        </select>*@

        @Html.DropDownListFor(x => x.TeaserName, (IEnumerable<SelectListItem>)ViewBag.Category, new { @class = "form-control", @id="TeaserIDDemo", @name="TeaserIDCodeDemo" })

    </div>

    <input type="button" id="sendDemo" name="SendDemo" value="send teaser" class="btn btn-success pull-right" style="margin-left: 20px">

    <div class="form-group pull-right" id="singleMsisdnDiv">
        <label class="control-label">MSISDN</label>

        <input id="msisdn" name="msisdn" class="form-control " tabindex="0">
    </div>


}


        <div class="teaser_part">

            <div style="margin-top: 20px" class="clearfix"></div>
            <label style="color: #000; font-weight: bold">XML editor</label>

            <div class="col-xs-12" id="XmlcontentAreaDiv" style="margin-top: -20px"></div>

            <input type="button" id="saveDemoTeaser" name="saveDemoTeaser" value="save"class="btn btn-success pull-right" style="margin-left: 20px; width: 100px">
        </div>
        <div class="clearfix"></div>

    </div>


    <div style="margin-top: 30px" class="clearfix"></div>
    <label style="color: #000; font-weight: bold">Delivery Logs</label>

    <div class="ICBLog" style="height: 300px">


    </div>
    <input type="button" id="saveIcbLogs" name="saveIcbLogs" value="Save logs" class="btn btn-success pull-right" style="margin-top: 20px; width: 100px">

</div>

<div class="col-md-5" style="padding-top: 40px;">

    <div class="demo-info">

        <p>ICB XML Parser Status: <span>ON</span></p>

        <p>ICB Kannel Server Status: <span>ON</span></p>

    </div>
    <div class="col-xs-9" id="midMobileDiv" style="width: 294px">

    </div>
    <div class="clearfix"></div>
</div>


@{ var @TeaserList = "%3C%3Fxml+version%3D%221.0%22+encoding%3D%22utf-8%22%3F%3E%0D%0A%3Cicbml%3E%0D%0A%0D%0A++%3Ccard+id%3D%22default%22%3E%0D%0A++++%3Cplay-tone%3E%0D%0A++++++%3Ctone+type%3D%22tenth-seconds%22+duration%3D%221%22+value%3D%2210%22%2F%3E%0D%0A++++%3C%2Fplay-tone%3E%0D%0A++%0D%0A++++%3Cdisplay+delay%3D%22no%22+priority%3D%22low%22%3E%0D%0A++++++%3Cstring%3E%0D%0A+++%3Ctext+encoding%3D%22ucs2%22%3E%D0%A1%D0%BC%D0%B5%D0%B9%D1%82%D0%B5%D1%81%D1%8C+%D0%B2%D0%B5%D1%81%D1%8C+%D0%B4%D0%B5%D0%BD%D1%8C%21+%D0%9B%D1%83%D1%87%D1%88%D0%B8%D0%B5+%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE+%D0%B8%D0%B7+%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%D0%B0%21+%D0%A5%D0%BE%D1%82%D0%B8%D1%82%D0%B5+%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B0%D1%82%D1%8C+%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE+%D1%87%D0%B5%D1%80%D0%B5%D0%B7+%D0%A1%D0%9C%D0%A1%3F%3C%2Ftext%3E%0D%0A++++++%3C%2Fstring%3E%0D%0A++++%3C%2Fdisplay%3E++++%0D%0A%0D%0A++++%3Cdisplay+delay%3D%22no%22+priority%3D%22low%22%3E%0D%0A++++++%3Cstring%3E%0D%0A+++++++++%3Ctext%3EClick+OK.+Activate+for+free+video+service+fro+3+days%2C+next+-+2+usd%2Fday.%3C%2Ftext%3E%0D%0A++++++%3C%2Fstring%3E%0D%0A++++%3C%2Fdisplay%3E++++++++++++++++++++++++++++%0D%0A+%0D%0A+++++%3Csend-ussd%3E%0D%0A+++++++%3Ctitle%3E%3Ctext%3EPlease+wait%3C%2Ftext%3E%3C%2Ftitle%3E%0D%0A++++++%3Cstring%3E%0D%0A+++++++++++++%3Ctext%3E%2A575%23%3C%2Ftext%3E%0D%0A++++++%3C%2Fstring%3E%0D%0A++++%3C%2Fsend-ussd%3E+++++++%0D%0A++%3C%2Fcard%3E%0D%0A%3C%2Ficbml%3E"; }

<script type="text/javascript">
    $(function () {
        $('#demo-teaser-menu').addClass('active');

       

        try {          
        
            loadTeaserXmlWithMobile("<?xml version='1.0' encoding='utf-8'?>");
        }
        catch (e) {
            console.log(e);
        }


        $('#TeaserIDDemo').on('change', function () {
            debugger;
            var ID = $(this).find('option:selected').val();


            if (parseInt(ID) < 0 || typeof ID == "undefined") {

                return false;
            } else {


                 
                $.ajax({
                    url:'@Url.Action("GetTeaserById", "TeaserDemoSender")',
                    type: "POST",
                    data: {TeaserID: ID},

                    beforeSend: function () {


                    },
                    complete: function (data) {
                        
                        try {

                            var response = $.parseJSON(data.responseText);

                            if (response.status == true && typeof response.Result != "undefined") {

                                var responseXml = decodeURIComponent(response.Result.TeaserXml.replace(/\+/g, ' '));

                                $('#midMobileDiv').html("");
                                $('#XmlcontentAreaDiv').html("");
                                loadTeaserXmlWithMobile(responseXml);
                            } else {

                            }

                        }
                        catch
                            (e) {


                        }


                    },
                    success: function (data) {


                    }
                });
            }
        });

        function loadTeaserXmlWithMobile($xmlData) {
            debugger;
            var $editor = $('#XmlContent').XmlMobileParser({
                baseUrl: '@baseurl',
                textArea: {
                    divId: 'XmlcontentAreaDiv',
                    height: 375,                   
                    margin: '7px auto',
                    text: $xmlData
                },
                mobile: {
                    "main": {
                        divId: 'midMobileDiv',
                        height: 417
                    },
                    "mobile": {
                        backgroundUrl: '@baseurl' + '/includes/images/TeaserManagement/UssdPhone.png',
                        width: 220,
                        height: 415
                    },
                    "MobileInnerPageNumber": {
                        width: 190,
                        height: 18,
                        top: 48,
                        left: 53,
                        border: '1px solid #C1C1C1',
                        display: 'none'
                    },
                    "MobileInnerDisplay": {
                        divId: 'midMobileDiv',
                        backgroundUrl: '@baseurl' + '/includes/images/TeaserManagement/ussd_phone_final.png',
                        width: 190,
                        height: 240,
                        top: 65,
                        left: 53,
                        border: '0px solid #C1C1C1',
                        textAlign: 'center',
                        verticalAlign: 'middle'
                    },
                    "leftArrow": {
                        backgroundUrl: '@baseurl' + '/includes/images/TeaserManagement/left.png',
                        backgroundUrlHover: '@baseurl' + '/includes/images/TeaserManagement/leftHover.png'
                    },
                    "rightArrow": {
                        backgroundUrl: '@baseurl' + '/includes/images/TeaserManagement/right.png',
                        backgroundUrlHover: '@baseurl' + '/includes/images/TeaserManagement/rightHover.png'
                    }
                },
                numberOfClicksID: 'numberOfClicks'
            });

            setEditor($editor);
            SetEditorText($xmlData);
        }

        $("div#Form :input[type='text']").prop('disabled', true);
        $("div#Form textarea").prop('disabled', true);
    });


</script>

